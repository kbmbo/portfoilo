<!DOCTYPE html>
<html lang="ko">
    <head>
        <title>loop slide</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=1.5">
        <style>
            * {
                box-sizing: border-box;
                -webkit-box-sizing: border-box;
                padding: 0;
                margin: 0;
                border: 0;
                outline: 0;
                vertical-align: baseline;
                background: transparent;
                font-weight: normal;
            }
            html { width: 100%; font-family: Dotum,'돋움',Helvetica,"Apple SD Gothic Neo",'sans-serif';font-size: 10px; scroll-behavior: smooth; word-break:keep-all; }
            body { width: 100%; background-color: #fff; font-size: 1.5rem; font-weight: 400; color: #222; scroll-behavior: smooth; }
            li { list-style: none; }
            button { background-color: transparent; cursor: pointer; font-family: Dotum,'돋움',Helvetica,"Apple SD Gothic Neo",'sans-serif'; }
            aside, details, figcaption, figure, footer, header, hgroup, menu, nav { display: block; }
            a { text-decoration: none; color: #222; }
            .slide-container{ width: 100%; position: relative; }
            .veiw { width: 100%; position: relative; }
            .img-box { position: relative; width: 84%; margin: 0 auto; overflow: hidden; }
            .slide { margin: 0; padding:0; }
            .slide li { position: relative; height: 0; padding-bottom: 9%; background-position: center; background-repeat: no-repeat; background-size: cover; float: left; }
            .pager { position: absolute; top: 0; display: flex; justify-content: space-between; align-items:center; width: 100%; }
            .pager button { position: relative; font-size: 0; width: 7vmin; height: 10vmin; display: flex; justify-content: space-around; align-items:center; }
            
            .pager button:before, .pager button:after { content: ''; display: block; width: 3px; height: 50%; background-color: #c3c3c3; position: absolute; }
            .pager button.prev:before, .pager button.next:after { transform: rotate(-45deg); }
            .pager button.prev:after, .pager button.next:before { transform: rotate(45deg); }
            .pager button.prev:before, .pager button.next:before { bottom:0.8vmin }
            .pager button.prev:after, .pager button.next:after { top:0.8vmin }
            .paging { display: flex; justify-content: center; margin-top: 10px; }
            .paging li { margin: 0 5px; cursor: pointer; }
            .paging li.active { font-weight: 600; }
            @media (hover: hover) {
                .pager button:hover { opacity: 0.6;}
            }
            @media screen and (max-width:428px) {
                .img-box { position: relative; width: 100%;}
                .pager button {background-color: rgba(0,0,0,.4);width: 5vmin;}
                .pager button:before, .pager button:after {width: 1px;}
            }
        </style>

        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", () => {
                const imgUrl = [{url:'./img/1.jpg'},{url:'./img/2.jpg'},{url:'./img/3.jpg'},{url:'./img/4.jpg'}];
                const imgBox = document.querySelector('.imgBox');
                const slide=document.querySelector('.Slide');
                const veiw = document.querySelector('.Veiw');
                const paging = document.querySelector('.Paging');
                const pager = document.querySelector('.Pager');
                const total = imgUrl.length+2;
                const slideSpeed = 1000; 
                const pagingChild = paging.children;
                const slideChild = slide.children;
                const pagerChild = pager.children;
                const tX = parseFloat(`${(100/total).toFixed(3)}`); // 분할시 소수점으로 인한 계산 오류로 뒤 소수점 제거 필요
                
                let i = -tX;
                let imgBoxW;
                let type;
                let stX;
                let pagingNum = 0;

                slide.style.width=`${((total)*100)}%`;
                slide.style.transition = "0ms";
                slide.style.transform =`translateX(${i}%)`;
                
                imgUrl.forEach( (el,index) => { // imgUrl 내용 만큼 슬라이드 생성
                    slide.insertAdjacentHTML('beforeend', `<li style = 'background-image:url(${el.url});'></li>`);
                    paging.insertAdjacentHTML('beforeend', `<li data-num = '${index+1}'>${index+1}</li>`);
                })
                
                window.addEventListener('load', () => { // 슬라이드 엘리먼트 생성 후 슬라이드 맨앞 맨뒤 요소 복제해서 추가
                    
                    const firstChild = slide.firstElementChild;
                    const lastChild = slide.lastElementChild;
                    const clonedFirst = firstChild.cloneNode(true);
                    const clonedLast = lastChild.cloneNode(true);

                    slide.insertAdjacentHTML('afterbegin', clonedLast.outerHTML);
                    slide.insertAdjacentHTML('beforeend', clonedFirst.outerHTML);

                    paging.firstElementChild.classList.add('active');

                    imgBoxW = getComputedStyle(imgBox).width;
                    Array.from(slideChild).forEach( el => { //화면보다 슬라이더 세로가 길어지는 경우 스크롤바로 인해 가로값과 높이값 오류생김 대응. 로드에서 한번더 반영 체크
                        el.style.width = imgBoxW;
                        pager.style.height = getComputedStyle(imgBox).height;
                    })
                });

                const PagingActive = pagingNum => { // 슬라이드 위치 표시 css
                    Array.from(pagingChild).forEach( el => {
                        el.classList.remove('active');
                    })
                    pagingChild[pagingNum].classList.add('active');
                }

                const transform = type => { // 다음 이전 버튼 이벤트,터치 이벤트
                    pagingNum
                    i
                    if(type == 'next' && -i < (total-1)*tX){ // 다음 버튼
                        i = i - tX;
                        if(-i === (total-1)*tX){ // 시작 지점이 두번째 이므로 total-1 해서 클론 퍼스트값 구하고 해당지점 됐을때 원본 퍼스트로 보내줌
                            setTimeout(function() {
                                slide.style.transition = "0ms";
                                slide.style.transform =`translateX(-${tX}%)`;
                                i = -tX;
                            }, slideSpeed+1);
                        }
                        pagingNum === imgUrl.length-1 ? pagingNum = 0 : pagingNum++
                    } else if(type == 'prev' && i < 0){ //이전 버튼
                        i = i + tX;
                        if(i == 0){ //맨앞에 있는 클론 라스트에 도달했을때 원본 라스트로 보내줌
                            setTimeout(function() {
                                slide.style.transition = "0ms";
                                slide.style.transform =`translateX(-${(tX*imgUrl.length)}%)`;
                                i = -((tX*imgUrl.length));
                            }, slideSpeed);
                        } 
                        pagingNum > 0 ? pagingNum-- : (pagingNum === 0 ? pagingNum = imgUrl.length-1 : null)                  
                    }
                    slide.style.transition = `${slideSpeed}ms`;
                    slide.style.transform =`translateX(${i}%)`
                    PagingActive(pagingNum);
                }

                window.addEventListener('resize', () => { // resize시 사이즈 반영 
                    imgBoxW = getComputedStyle(imgBox).width;
                    Array.from(slideChild).forEach( el => {
                        el.style.width = imgBoxW;
                        pager.style.height = getComputedStyle(imgBox).height;
                    })
                });

                Array.from(pagerChild).forEach( el => el.addEventListener('click', e => { // 다음 이전 버튼 클릭 이벤트 실행
                    type = e.target.dataset.pager;
                    transform(type);
                }));

                paging.addEventListener('click', e => { // 슬라이드 위치 버튼 클릭시 슬라이드 이동
                    pagingNum = e.target.dataset.num-1;
                    i = - (pagingNum+1)*tX
                    e.target.dataset.num !== undefined ? PagingActive(pagingNum) : null;
                    
                    slide.style.transition = `${slideSpeed}ms`;
                    slide.style.transform =`translateX(-${(pagingNum+1)*tX}%)`;
                });
                
                veiw.addEventListener('touchstart', e => { // 터치 스타트 지점 
                    //e.preventDefault();
                    stX=event.touches[0].pageX;
                });

                veiw.addEventListener('touchend',  e => { // 터치 스타트에서 받아온 값과 비교해 오른쪽에서 왼쪽인지(다음) 반대인지(이전) 체크
                    let endX=e.changedTouches[0].pageX;
                    e.target.dataset.pager === undefined ? ( type = (stX-endX) > 0 ? 'next' : 'prev', transform(type) ) : null;
                });

            });
        </script>
        
    </head>
    <body>
        <div class="slide-container">
            <div class="Veiw veiw">
                <div class="imgBox img-box">
                    <ul class="Slide slide">
                    </ul>
                </div>
                <div class="Pager pager">
                    <button type="button" data-pager="prev" class="prev">prev</button>
                    <button type="button" data-pager="next" class="next">next</button>
                </div>
            </div>
            <ul class="Paging paging"></ul>
        </div>
    </body>
</html>
